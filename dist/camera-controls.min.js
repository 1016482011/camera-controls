!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.cameraControlsFactory=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}return function(e){var i=new e.Vector3,s=new e.Vector3,a=new e.Vector3,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};return function(){function o(s,a){if(t(this,o),this.object=s,this.minDistance=0,this.maxDistance=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.zoomSpeed=1,this.domElement=a,this._target=new e.Vector3,this._targetEnd=new e.Vector3,this._spherical=new e.Spherical,this._spherical.setFromVector3(this.object.position),this._sphericalEnd=(new e.Spherical).copy(this._spherical),this._target0=this._target.clone(),this._position0=this.object.position.clone(),this._needsUpdate=!0,this.update(),this.domElement){var h=function(t){t.preventDefault();var i=g;switch(t.button){case e.MOUSE.LEFT:g=n.ROTATE;break;case e.MOUSE.MIDDLE:g=n.DOLLY;break;case e.MOUSE.RIGHT:g=n.PAN}i===n.NONE&&p(t)},r=function(t){t.preventDefault();var e=g;switch(t.touches.length){case 1:g=n.TOUCH_ROTATE;break;case 2:g=n.TOUCH_DOLLY;break;case 3:g=n.TOUCH_PAN}e===n.NONE&&p(t)},c=function(t){t.preventDefault(),t.deltaY<0?m():t.deltaY>0&&_()},d=function(t){t.preventDefault()},p=function(t){t.preventDefault();var e=t.clientX||t.touches[0].clientX,i=t.clientY||t.touches[0].clientY;if(y=E.domElement.getBoundingClientRect(),v.set(e,i),g===n.TOUCH_DOLLY){var s=e-t.touches[1].pageX,a=i-t.touches[1].pageY,o=Math.sqrt(s*s+a*a);f.set(0,o)}L=E.dampingFactor,E.dampingFactor=E.draggingDampingFactor,document.addEventListener("mousemove",l,{passive:!1}),document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("mouseup",u),document.addEventListener("touchend",u)},l=function(t){t.preventDefault();var e=t.clientX||t.touches[0].clientX,s=t.clientY||t.touches[0].clientY,a=v.x-e,o=v.y-s;switch(v.set(e,s),g){case n.ROTATE:case n.TOUCH_ROTATE:var h=2*Math.PI*a/y.width,r=2*Math.PI*o/y.height;E.rotate(h,r,!0);break;case n.DOLLY:break;case n.TOUCH_DOLLY:var c=e-t.touches[1].pageX,d=s-t.touches[1].pageY,p=Math.sqrt(c*c+d*d),l=f.y-p;l>0?_():l<0&&m(),f.set(0,p);break;case n.PAN:case n.TOUCH_PAN:var u=i.copy(E.object.position).sub(E._target).length()*Math.tan(E.object.fov/2*Math.PI/180),L=2*a*u/y.height,O=2*o*u/y.height;E.pan(L,O,!0)}},u=function t(e){E.dampingFactor=L,g=n.NONE,document.removeEventListener("mousemove",l),document.removeEventListener("touchmove",l),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t)},m=function(){var t=Math.pow(.95,E.zoomSpeed);E.dolly(E._sphericalEnd.radius*t-E._sphericalEnd.radius)},_=function(){var t=Math.pow(.95,E.zoomSpeed);E.dolly(E._sphericalEnd.radius/t-E._sphericalEnd.radius)},E=this,v=new e.Vector2,f=new e.Vector2,g=n.NONE,y=void 0,L=void 0;this.domElement.addEventListener("mousedown",h),this.domElement.addEventListener("touchstart",r),this.domElement.addEventListener("wheel",c),this.domElement.addEventListener("contextmenu",d),this.dispose=function(){E.domElement.removeEventListener("mousedown",h),E.domElement.removeEventListener("touchstart",r),E.domElement.removeEventListener("wheel",c),E.domElement.removeEventListener("contextmenu",d),document.removeEventListener("mousemove",l),document.removeEventListener("touchmove",l),document.removeEventListener("mouseup",u),document.removeEventListener("touchend",u)}}else this.dispose=function(){}}return o.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},o.prototype.rotateTo=function(t,e,i){this._sphericalEnd.theta=t,this._sphericalEnd.phi=e,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},o.prototype.dolly=function(t,e){this.dollyTo(this._sphericalEnd.radius+t,e)},o.prototype.dollyTo=function(t,i){this._sphericalEnd.radius=e.Math.clamp(t,this.minDistance,this.maxDistance),i||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0},o.prototype.pan=function(t,e,n){this.object.updateMatrix(),s.setFromMatrixColumn(this.object.matrix,0),a.setFromMatrixColumn(this.object.matrix,1),s.multiplyScalar(t),a.multiplyScalar(-e);var o=i.copy(s).add(a);this._targetEnd.add(o),n||this._target.copy(this._targetEnd),this._needsUpdate=!0},o.prototype.moveTo=function(t,e,i,s){this._targetEnd.set(t,e,i),s||this._target.copy(this._targetEnd),this._needsUpdate=!0},o.prototype.saveState=function(){this._target0.copy(this.target),this._position0.copy(this.object.position)},o.prototype.reset=function(t){this._targetEnd.copy(this._target0),this._sphericalEnd.setFromVector3(this._position0),this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta=this._sphericalEnd.theta,t||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},o.prototype.update=function(t){var i=this.dampingFactor*t/.016,s=this._sphericalEnd.theta-this._spherical.theta,a=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,o=(new e.Vector3).subVectors(this._targetEnd,this._target);Math.abs(s)>.01||Math.abs(a)>.01||Math.abs(n)>.01||Math.abs(o.x)>.01||Math.abs(o.y)>.01||Math.abs(o.z)>.01?(this._spherical.set(this._spherical.radius+n*i,this._spherical.phi+a*i,this._spherical.theta+s*i),this._target.add(o.multiplyScalar(i)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var h=this._needsUpdate;return this._needsUpdate=!1,h},o}()}});
