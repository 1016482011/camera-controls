!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";var t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._listeners={}}return t.prototype.addEventListener=function(t,e){var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},t.prototype.hasEventListener=function(t,e){var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},t.prototype.removeEventListener=function(t,e){var i=this._listeners[t];if(void 0!==i){var a=i.indexOf(e);-1!==a&&i.splice(a,1)}},t.prototype.dispatchEvent=function(t){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),a=0,o=i.length;a<o;a++)i[a].call(this,t)}},t}();var w=void 0,M=void 0,b=void 0,o=void 0,n=void 0,A=void 0,x=void 0,h=.001,l=-1,j=0,S=1,D=2,L=3,z=4,k=5;function e(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function s(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}return function(p){function d(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,p.call(this));if(i.object=t,i.enabled=!0,i._state=l,i.minDistance=0,i.maxDistance=1/0,i.minZoom=0,i.maxZoom=1/0,i.minPolarAngle=0,i.maxPolarAngle=Math.PI,i.minAzimuthAngle=-1/0,i.maxAzimuthAngle=1/0,i.dampingFactor=.05,i.draggingDampingFactor=.25,i.dollySpeed=1,i.truckSpeed=2,i.verticalDragToForward=!1,i.domElement=e,i._target=new w.Vector3,i._targetEnd=new w.Vector3,i._spherical=new w.Spherical,i._spherical.setFromVector3(i.object.position),i._sphericalEnd=(new w.Spherical).copy(i._spherical),i._target0=i._target.clone(),i._position0=i.object.position.clone(),i._zoom0=i.object.zoom,i._needsUpdate=!0,i.update(),i.domElement){var a=function(t){if(y.enabled){t.preventDefault();var e=y._state;switch(t.button){case w.MOUSE.LEFT:y._state=j;break;case w.MOUSE.MIDDLE:y._state=S;break;case w.MOUSE.RIGHT:y._state=D}e!==y._state&&r(t)}},o=function(t){if(y.enabled){t.preventDefault();var e=y._state;switch(t.touches.length){case 1:y._state=L;break;case 2:y._state=z;break;case 3:y._state=k}e!==y._state&&r(t)}},n=function(t){if(y.enabled){t.preventDefault();var e=0===navigator.platform.indexOf("Mac")?-1:-3,i=void 0;i=void 0!==t.wheelDelta?t.wheelDelta/120:1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e),E(-i)}},s=function(t){y.enabled&&t.preventDefault()},r=function(t){if(y.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,a=e.clientY;if(x=y.domElement.getBoundingClientRect(),b.set(i,a),y._state===z){var o=i-t.touches[1].pageX,n=a-t.touches[1].pageY,s=Math.sqrt(o*o+n*n);A.set(0,s)}document.addEventListener("mousemove",h,{passive:!1}),document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("mouseup",c),document.addEventListener("touchend",c),y.dispatchEvent({type:"controlstart",x:i,y:a,state:y._state,originalEvent:t})}},h=function(t){if(y.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,a=e.clientY,o=b.x-i,n=b.y-a;switch(b.set(i,a),y._state){case j:case L:var s=2*Math.PI*o/x.width,r=2*Math.PI*n/x.height;y.rotate(s,r,!0);break;case S:break;case z:var h=i-t.touches[1].pageX,c=a-t.touches[1].pageY,p=Math.sqrt(h*h+c*c),d=A.y-p;E(d/8),A.set(0,p);break;case D:case k:if(y.object.isPerspectiveCamera){var l=M.copy(y.object.position).sub(y._target),m=y.object.fov*w.Math.DEG2RAD,u=l.length()*Math.tan(m/2),g=y.truckSpeed*o*u/x.height,_=y.truckSpeed*n*u/x.height;y.verticalDragToForward?(y.truck(g,0,!0),y.forward(-_,!0)):y.truck(g,_,!0);break}if(y.object.isOrthographicCamera){var v=o*(y.object.right-y.object.left)/y.object.zoom/x.width,f=n*(y.object.top-y.object.bottom)/y.object.zoom/x.height;y.truck(v,f,!0);break}}y.dispatchEvent({type:"control",x:i,y:a,deltaX:o,deltaY:n,state:y._state,originalEvent:t})}},c=function t(){y.enabled&&(y._state=l,document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t),y.dispatchEvent({type:"controlend",state:y._state,originalEvent:event}))},E=function(t){var e=Math.pow(.95,-t*y.dollySpeed);y.object.isPerspectiveCamera?y.dolly(y._sphericalEnd.radius*e-y._sphericalEnd.radius):y.object.isOrthographicCamera&&(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom*e)),y.object.updateProjectionMatrix(),y._needsUpdate=!0)},y=i,b=new w.Vector2,A=new w.Vector2,x=void 0;i.domElement.addEventListener("mousedown",a),i.domElement.addEventListener("touchstart",o),i.domElement.addEventListener("wheel",n),i.domElement.addEventListener("contextmenu",s),i.dispose=function(){y.domElement.removeEventListener("mousedown",a),y.domElement.removeEventListener("touchstart",o),y.domElement.removeEventListener("wheel",n),y.domElement.removeEventListener("contextmenu",s),document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",c),document.removeEventListener("touchend",c)}}else i.dispose=function(){};return i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,p),d.install=function(t){w=t.THREE,M=new w.Vector3,b=new w.Vector3,o=new w.Vector3,n=new w.Vector3,A=new w.Spherical,x=new w.Spherical},d.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},d.prototype.rotateTo=function(t,e,i){var a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=a,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},d.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},d.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=w.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},d.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},d.prototype.truck=function(t,e,i){this.object.updateMatrix(),o.setFromMatrixColumn(this.object.matrix,0),n.setFromMatrixColumn(this.object.matrix,1),o.multiplyScalar(t),n.multiplyScalar(-e);var a=M.copy(o).add(n);this._targetEnd.add(a),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.forward=function(t,e){M.setFromMatrixColumn(this.object.matrix,0),M.crossVectors(this.object.up,M),M.multiplyScalar(t),this._targetEnd.add(M),e||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.moveTo=function(t,e,i,a){this._targetEnd.set(t,e,i),a||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.fitTo=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var a=i.paddingLeft||0,o=i.paddingRight||0,n=i.paddingBottom||0,s=i.paddingTop||0,r=t.isBox3?t.clone():(new w.Box3).setFromObject(t),h=r.getSize(M),c=h.x+a+o,p=h.y+s+n,d=h.z,l=this.getDistanceToFit(c,p,d);this.dollyTo(l,e);var m=r.getCenter(M),u=m.x-(.5*a-.5*o),g=m.y+(.5*s-.5*n),_=m.z;this.moveTo(u,g,_,e),this._sanitizeSphericals(),this.rotateTo(0,90*w.Math.DEG2RAD,e)}},d.prototype.setLookAt=function(t,e,i,a,o,n,s){var r=M.set(t,e,i),h=b.set(a,o,n);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(r.sub(h)),this._sanitizeSphericals(),s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype.lerpLookAt=function(t,e,i,a,o,n,s,r,h,c,p,d,l,m){var u=M.set(t,e,i),g=b.set(a,o,n);A.setFromVector3(u.sub(g));var _=M.set(c,p,d);this._targetEnd.copy(g).lerp(_,l);var v=b.set(s,r,h);x.setFromVector3(v.sub(_));var f=x.theta-A.theta,E=x.phi-A.phi,y=x.radius-A.radius;this._sphericalEnd.set(A.radius+y*l,A.phi+E*l,A.theta+f*l),this._sanitizeSphericals(),m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype.setPosition=function(t,e,i,a){this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,a)},d.prototype.setTarget=function(t,e,i,a){var o=this.getPosition(M);this.setLookAt(o.x,o.y,o.z,t,e,i,a)},d.prototype.getDistanceToFit=function(t,e,i){var a=this.object,o=t/e,n=a.fov*w.Math.DEG2RAD,s=a.aspect;return.5*(o<s?e:t/s)/Math.tan(.5*n)+.5*i},d.prototype.getTarget=function(t){return(t&&t.isVector3?t:new w.Vector3).copy(this._targetEnd)},d.prototype.getPosition=function(t){return(t&&t.isVector3?t:new w.Vector3).setFromSpherical(this._sphericalEnd).add(this._targetEnd)},d.prototype.reset=function(t){this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t)},d.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},d.prototype.update=function(t){var e=this._state===l?this.dampingFactor:this.draggingDampingFactor,i=1-Math.exp(-e*t/.016),a=this._sphericalEnd.theta-this._spherical.theta,o=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,s=M.subVectors(this._targetEnd,this._target);Math.abs(a)>h||Math.abs(o)>h||Math.abs(n)>h||Math.abs(s.x)>h||Math.abs(s.y)>h||Math.abs(s.z)>h?(this._spherical.set(this._spherical.radius+n*i,this._spherical.phi+o*i,this._spherical.theta+a*i),this._target.add(s.multiplyScalar(i)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var r=this._needsUpdate;return this._needsUpdate=!1,r&&this.dispatchEvent({type:"update"}),r},d.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:e(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:e(this.maxPolarAngle),minAzimuthAngle:e(this.minAzimuthAngle),maxAzimuthAngle:e(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},d.prototype.fromJSON=function(t,e){var i=JSON.parse(t),a=(new w.Vector3).fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=s(i.maxDistance),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=s(i.maxPolarAngle),this.minAzimuthAngle=s(i.minAzimuthAngle),this.maxAzimuthAngle=s(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._targetEnd.fromArray(i.target),this._sphericalEnd.setFromVector3(a.sub(this._target0)),e||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype._sanitizeSphericals=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta+=2*Math.PI*Math.round((this._sphericalEnd.theta-this._spherical.theta)/(2*Math.PI))},d}(t)});
