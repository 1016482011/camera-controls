!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";function t(){}Object.assign(t.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var o=i.indexOf(e);-1!==o&&i.splice(o,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),o=0,a=i.length;o<a;o++)i[o].call(this,t)}}}});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var M=void 0,S=void 0,x=void 0,a=void 0,n=void 0,h=.001,l=-1,j=0,w=1,D=2,L=3,z=4,k=5;function i(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function s(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}return function(p){function d(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,p.call(this));if(i.object=t,i.enabled=!0,i._state=l,i.minDistance=0,i.maxDistance=1/0,i.minZoom=0,i.maxZoom=1/0,i.minPolarAngle=0,i.maxPolarAngle=Math.PI,i.minAzimuthAngle=-1/0,i.maxAzimuthAngle=1/0,i.dampingFactor=.05,i.draggingDampingFactor=.25,i.dollySpeed=1,i.truckSpeed=2,i.verticalDragToForward=!1,i.domElement=e,i._target=new M.Vector3,i._targetEnd=new M.Vector3,i._spherical=new M.Spherical,i._spherical.setFromVector3(i.object.position),i._sphericalEnd=(new M.Spherical).copy(i._spherical),i._target0=i._target.clone(),i._position0=i.object.position.clone(),i._zoom0=i.object.zoom,i._needsUpdate=!0,i.update(),i.domElement){var o=function(t){if(E.enabled){t.preventDefault();var e=E._state;switch(t.button){case M.MOUSE.LEFT:E._state=j;break;case M.MOUSE.MIDDLE:E._state=w;break;case M.MOUSE.RIGHT:E._state=D}e!==E._state&&r(t)}},a=function(t){if(E.enabled){t.preventDefault();var e=E._state;switch(t.touches.length){case 1:E._state=L;break;case 2:E._state=z;break;case 3:E._state=k}e!==E._state&&r(t)}},n=function(t){if(E.enabled){t.preventDefault();var e=0===navigator.platform.indexOf("Mac")?-1:-3,i=void 0;i=void 0!==t.wheelDelta?t.wheelDelta/120:1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e),y(i)}},s=function(t){E.enabled&&t.preventDefault()},r=function(t){if(E.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,o=e.clientY;if(x=E.domElement.getBoundingClientRect(),b.set(i,o),E._state===z){var a=i-t.touches[1].pageX,n=o-t.touches[1].pageY,s=Math.sqrt(a*a+n*n);A.set(0,s)}document.addEventListener("mousemove",h,{passive:!1}),document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("mouseup",c),document.addEventListener("touchend",c),E.dispatchEvent({type:"controlstart",x:i,y:o,state:E._state,originalEvent:t})}},h=function(t){if(E.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,o=e.clientY,a=b.x-i,n=b.y-o;switch(b.set(i,o),E._state){case j:case L:var s=2*Math.PI*a/x.width,r=2*Math.PI*n/x.height;E.rotate(s,r,!0);break;case w:break;case z:var h=i-t.touches[1].pageX,c=o-t.touches[1].pageY,p=Math.sqrt(h*h+c*c),d=A.y-p;y(d/8),A.set(0,p);break;case D:case k:if(E.object.isPerspectiveCamera){var l=S.copy(E.object.position).sub(E._target),m=E.object.fov*M.Math.DEG2RAD,u=l.length()*Math.tan(m/2),_=E.truckSpeed*a*u/x.height,g=E.truckSpeed*n*u/x.height;E.verticalDragToForward?(E.truck(_,0,!0),E.forward(-g,!0)):E.truck(_,g,!0);break}if(E.object.isOrthographicCamera){var f=a*(E.object.right-E.object.left)/E.object.zoom/x.width,v=n*(E.object.top-E.object.bottom)/E.object.zoom/x.height;E.truck(f,v,!0);break}}E.dispatchEvent({type:"control",x:i,y:o,deltaX:a,deltaY:n,state:E._state,originalEvent:t})}},c=function t(){E.enabled&&(E._state=l,document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t),E.dispatchEvent({type:"controlend",state:E._state,originalEvent:event}))},y=function(t){var e=Math.pow(.95,-t*E.dollySpeed);E.object.isPerspectiveCamera?E.dolly(E._sphericalEnd.radius*e-E._sphericalEnd.radius):E.object.isOrthographicCamera&&(E.object.zoom=Math.max(E.minZoom,Math.min(E.maxZoom,E.object.zoom*e)),E.object.updateProjectionMatrix(),E._needsUpdate=!0)},E=i,b=new M.Vector2,A=new M.Vector2,x=void 0;i.domElement.addEventListener("mousedown",o),i.domElement.addEventListener("touchstart",a),i.domElement.addEventListener("wheel",n),i.domElement.addEventListener("contextmenu",s),i.dispose=function(){E.domElement.removeEventListener("mousedown",o),E.domElement.removeEventListener("touchstart",a),E.domElement.removeEventListener("wheel",n),E.domElement.removeEventListener("contextmenu",s),document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",c),document.removeEventListener("touchend",c)}}else i.dispose=function(){};return i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,p),d.install=function(t){M=t.THREE,S=new M.Vector3,x=new M.Vector3,a=new M.Vector3,n=new M.Vector3},d.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},d.prototype.rotateTo=function(t,e,i){var o=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=o,this._sphericalEnd.phi=a,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},d.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},d.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=M.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},d.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},d.prototype.truck=function(t,e,i){this.object.updateMatrix(),a.setFromMatrixColumn(this.object.matrix,0),n.setFromMatrixColumn(this.object.matrix,1),a.multiplyScalar(t),n.multiplyScalar(-e);var o=S.copy(a).add(n);this._targetEnd.add(o),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.forward=function(t,e){S.setFromMatrixColumn(this.object.matrix,0),S.crossVectors(this.object.up,S),S.multiplyScalar(t),this._targetEnd.add(S),e||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.moveTo=function(t,e,i,o){this._targetEnd.set(t,e,i),o||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.fitTo=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var o=i.paddingLeft||0,a=i.paddingRight||0,n=i.paddingBottom||0,s=i.paddingTop||0,r=t.isBox3?t.clone():(new M.Box3).setFromObject(t),h=r.getSize(S),c=h.x+o+a,p=h.y+s+n,d=h.z,l=this.getDistanceToFit(c,p,d);this.dollyTo(l,e);var m=r.getCenter(S),u=m.x-(.5*o-.5*a),_=m.y+(.5*s-.5*n),g=m.z;this.moveTo(u,_,g,e),this._sanitizeSphericals(),this.rotateTo(0,90*M.Math.DEG2RAD,e)}},d.prototype.setLookAt=function(t,e,i,o,a,n,s){var r=S.set(t,e,i),h=x.set(o,a,n);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(r.sub(h)),this._sanitizeSphericals(),s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype.lerpLookAt=function(t,e,i,o,a,n,s,r,h,c,p,d,l,m){var u=S.set(t,e,i),_=x.set(o,a,n),g=(new M.Spherical).setFromVector3(u.sub(_)),f=S.set(c,p,d);this._targetEnd.copy(_).lerp(f,l);var v=x.set(s,r,h),y=(new M.Spherical).setFromVector3(v.sub(f)),E=y.theta-g.theta,b=y.phi-g.phi,A=y.radius-g.radius;this._sphericalEnd.set(g.radius+A*l,g.phi+b*l,g.theta+E*l),this._sanitizeSphericals(),m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype.setPosition=function(t,e,i,o){this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,o)},d.prototype.setTarget=function(t,e,i,o){var a=this.getPosition(S);this.setLookAt(a.x,a.y,a.z,t,e,i,o)},d.prototype.getDistanceToFit=function(t,e,i){var o=this.object,a=t/e,n=o.fov*M.Math.DEG2RAD,s=o.aspect;return.5*(a<s?e:t/s)/Math.tan(.5*n)+.5*i},d.prototype.getTarget=function(t){return("object"===(void 0===t?"undefined":e(t))&&t.isVector3?t:new M.Vector3).copy(this._targetEnd)},d.prototype.getPosition=function(t){return("object"===(void 0===t?"undefined":e(t))&&t.isVector3?t:new M.Vector3).setFromSpherical(this._sphericalEnd).add(this._targetEnd)},d.prototype.reset=function(t){this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t)},d.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},d.prototype.update=function(t){var e=this._state===l?this.dampingFactor:this.draggingDampingFactor,i=1-Math.exp(-e*t/.016),o=this._sphericalEnd.theta-this._spherical.theta,a=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,s=(new M.Vector3).subVectors(this._targetEnd,this._target);Math.abs(o)>h||Math.abs(a)>h||Math.abs(n)>h||Math.abs(s.x)>h||Math.abs(s.y)>h||Math.abs(s.z)>h?(this._spherical.set(this._spherical.radius+n*i,this._spherical.phi+a*i,this._spherical.theta+o*i),this._target.add(s.multiplyScalar(i)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var r=this._needsUpdate;return r&&this.dispatchEvent({type:"update"}),this._needsUpdate=!1,r},d.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:i(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:i(this.maxPolarAngle),minAzimuthAngle:i(this.minAzimuthAngle),maxAzimuthAngle:i(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},d.prototype.fromJSON=function(t,e){var i=JSON.parse(t),o=(new M.Vector3).fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=s(i.maxDistance),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=s(i.maxPolarAngle),this.minAzimuthAngle=s(i.minAzimuthAngle),this.maxAzimuthAngle=s(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._targetEnd.fromArray(i.target),this._sphericalEnd.setFromVector3(o.sub(this._target0)),e||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype._sanitizeSphericals=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta+=2*Math.PI*Math.round((this._sphericalEnd.theta-this._spherical.theta)/(2*Math.PI))},d}(t)});
