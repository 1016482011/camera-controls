!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";var p=void 0,L=void 0,a=void 0,n=void 0,h=.01,O={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};return function(){function d(t,e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),this.object=t,this.enabled=!0,this.minDistance=0,this.maxDistance=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.zoomSpeed=1,this.domElement=e,this._target=new p.Vector3,this._targetEnd=new p.Vector3,this._spherical=new p.Spherical,this._spherical.setFromVector3(this.object.position),this._sphericalEnd=(new p.Spherical).copy(this._spherical),this._target0=this._target.clone(),this._position0=this.object.position.clone(),this._needsUpdate=!0,this.update(),this.domElement){var i=function(t){if(!1!==v.enabled){t.preventDefault();var e=b;switch(t.button){case p.MOUSE.LEFT:b=O.ROTATE;break;case p.MOUSE.MIDDLE:b=O.DOLLY;break;case p.MOUSE.RIGHT:b=O.PAN}e===O.NONE&&o(t)}},s=function(t){if(!1!==v.enabled){t.preventDefault();var e=b;switch(t.touches.length){case 1:b=O.TOUCH_ROTATE;break;case 2:b=O.TOUCH_DOLLY;break;case 3:b=O.TOUCH_PAN}e===O.NONE&&o(t)}},a=function(t){!1!==v.enabled&&(t.preventDefault(),t.deltaY<0?_():0<t.deltaY&&E())},n=function(t){!1!==v.enabled&&t.preventDefault()},o=function(t){if(!1!==v.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,s=e.clientY;if(y=v.domElement.getBoundingClientRect(),g.set(i,s),b===O.TOUCH_DOLLY){var a=i-t.touches[1].pageX,n=s-t.touches[1].pageY,o=Math.sqrt(a*a+n*n);f.set(0,o)}c=v.dampingFactor,v.dampingFactor=v.draggingDampingFactor,document.addEventListener("mousemove",h,{passive:!1}),document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("mouseup",r),document.addEventListener("touchend",r)}},h=function(t){if(!1!==v.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,s=e.clientY,a=g.x-i,n=g.y-s;switch(g.set(i,s),b){case O.ROTATE:case O.TOUCH_ROTATE:var o=2*Math.PI*a/y.width,h=2*Math.PI*n/y.height;v.rotate(o,h,!0);break;case O.DOLLY:break;case O.TOUCH_DOLLY:var r=i-t.touches[1].pageX,c=s-t.touches[1].pageY,d=Math.sqrt(r*r+c*c),p=f.y-d;0<p?E():p<0&&_(),f.set(0,d);break;case O.PAN:case O.TOUCH_PAN:var l=L.copy(v.object.position).sub(v._target).length()*Math.tan(v.object.fov/2*Math.PI/180),m=2*a*l/y.height,u=2*n*l/y.height;v.pan(m,u,!0)}}},r=function t(e){!1!==v.enabled&&(v.dampingFactor=c,b=O.NONE,document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t))},_=function(){var t=Math.pow(.95,v.zoomSpeed);v.dolly(v._sphericalEnd.radius*t-v._sphericalEnd.radius)},E=function(){var t=Math.pow(.95,v.zoomSpeed);v.dolly(v._sphericalEnd.radius/t-v._sphericalEnd.radius)},v=this,g=new p.Vector2,f=new p.Vector2,b=O.NONE,y=void 0,c=void 0;this.domElement.addEventListener("mousedown",i),this.domElement.addEventListener("touchstart",s),this.domElement.addEventListener("wheel",a),this.domElement.addEventListener("contextmenu",n),this.dispose=function(){v.domElement.removeEventListener("mousedown",i),v.domElement.removeEventListener("touchstart",s),v.domElement.removeEventListener("wheel",a),v.domElement.removeEventListener("contextmenu",n),document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",r),document.removeEventListener("touchend",r)}}else this.dispose=function(){}}return d.install=function(t){p=t.THREE,L=new p.Vector3,a=new p.Vector3,n=new p.Vector3},d.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},d.prototype.rotateTo=function(t,e,i){var s=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=s,this._sphericalEnd.phi=a,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},d.prototype.dolly=function(t,e){this.dollyTo(this._sphericalEnd.radius+t,e)},d.prototype.dollyTo=function(t,e){this._sphericalEnd.radius=p.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0},d.prototype.pan=function(t,e,i){this.object.updateMatrix(),a.setFromMatrixColumn(this.object.matrix,0),n.setFromMatrixColumn(this.object.matrix,1),a.multiplyScalar(t),n.multiplyScalar(-e);var s=L.copy(a).add(n);this._targetEnd.add(s),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.moveTo=function(t,e,i,s){this._targetEnd.set(t,e,i),s||this._target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.saveState=function(){this._target0.copy(this.target),this._position0.copy(this.object.position)},d.prototype.reset=function(t){this._targetEnd.copy(this._target0),this._sphericalEnd.setFromVector3(this._position0),this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta=this._spherical.theta%(2*Math.PI),t||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype.update=function(t){var e=this.dampingFactor*t/.016,i=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,a=this._sphericalEnd.radius-this._spherical.radius,n=(new p.Vector3).subVectors(this._targetEnd,this._target);Math.abs(i)>h||Math.abs(s)>h||Math.abs(a)>h||Math.abs(n.x)>h||Math.abs(n.y)>h||Math.abs(n.z)>h?(this._spherical.set(this._spherical.radius+a*e,this._spherical.phi+s*e,this._spherical.theta+i*e),this._target.add(n.multiplyScalar(e)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var o=this._needsUpdate;return this._needsUpdate=!1,o},d}()});
