!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var j=void 0,w=void 0,a=void 0,s=void 0,n=.001,d=-1,D=0,F=1,L=2,k=3,z=4,V=5;function t(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function r(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}return function(){function p(t,e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),this.object=t,this.enabled=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.dollySpeed=1,this.truckSpeed=2,this.verticalDragToForward=!1,this.domElement=e,this._target=new j.Vector3,this._targetEnd=new j.Vector3,this._spherical=new j.Spherical,this._spherical.setFromVector3(this.object.position),this._sphericalEnd=(new j.Spherical).copy(this._spherical),this._target0=this._target.clone(),this._position0=this.object.position.clone(),this._zoom0=this.object.zoom,this._needsUpdate=!0,this.update(),this.domElement){var i=function(t){if(v.enabled){t.preventDefault();var e=x;switch(t.button){case j.MOUSE.LEFT:x=D;break;case j.MOUSE.MIDDLE:x=F;break;case j.MOUSE.RIGHT:x=L}e===d&&r(t)}},o=function(t){if(v.enabled){t.preventDefault();var e=x;switch(t.touches.length){case 1:x=k;break;case 2:x=z;break;case 3:x=V}e===d&&r(t)}},a=function(t){v.enabled&&(t.preventDefault(),t.deltaY<0?b():0<t.deltaY&&y())},s=function(t){v.enabled&&t.preventDefault()},r=function(t){if(v.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,o=e.clientY;if(S=v.domElement.getBoundingClientRect(),A.set(i,o),x===z){var a=i-t.touches[1].pageX,s=o-t.touches[1].pageY,r=Math.sqrt(a*a+s*s);M.set(0,r)}c=v.dampingFactor,v.dampingFactor=v.draggingDampingFactor,document.addEventListener("mousemove",n,{passive:!1}),document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("mouseup",h),document.addEventListener("touchend",h)}},n=function(t){if(v.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,o=e.clientY,a=A.x-i,s=A.y-o;switch(A.set(i,o),x){case D:case k:var r=2*Math.PI*a/S.width,n=2*Math.PI*s/S.height;v.rotate(r,n,!0);break;case F:break;case z:var h=i-t.touches[1].pageX,c=o-t.touches[1].pageY,p=Math.sqrt(h*h+c*c),d=M.y-p;0<d?y():d<0&&b(),M.set(0,p);break;case L:case V:if(v.object.isPerspectiveCamera){var l=w.copy(v.object.position).sub(v._target),m=v.object.fov*j.Math.DEG2RAD,u=l.length()*Math.tan(m/2),g=v.truckSpeed*a*u/S.height,_=v.truckSpeed*s*u/S.height;v.verticalDragToForward?(v.truck(g,0,!0),v.forward(-_,!0)):v.truck(g,_,!0);break}if(v.object.isOrthographicCamera){var f=a*(v.object.right-v.object.left)/v.object.zoom/S.width,E=s*(v.object.top-v.object.bottom)/v.object.zoom/S.height;v.truck(f,E,!0);break}}}},h=function t(){v.enabled&&(v.dampingFactor=c,x=d,document.removeEventListener("mousemove",n),document.removeEventListener("touchmove",n),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t))},b=function(){var t=Math.pow(.95,v.dollySpeed);v.object.isPerspectiveCamera?v.dolly(v._sphericalEnd.radius*t-v._sphericalEnd.radius):v.object.isOrthographicCamera&&(v.object.zoom=Math.max(v.minZoom,Math.min(v.maxZoom,v.object.zoom*t)),v.object.updateProjectionMatrix(),v._needsUpdate=!0)},y=function(){var t=Math.pow(.95,v.dollySpeed);v.object.isPerspectiveCamera?v.dolly(v._sphericalEnd.radius/t-v._sphericalEnd.radius):v.object.isOrthographicCamera&&(v.object.zoom=Math.max(v.minZoom,Math.min(v.maxZoom,v.object.zoom/t)),v.object.updateProjectionMatrix(),v._needsUpdate=!0)},v=this,A=new j.Vector2,M=new j.Vector2,x=d,S=void 0,c=void 0;this.domElement.addEventListener("mousedown",i),this.domElement.addEventListener("touchstart",o),this.domElement.addEventListener("wheel",a),this.domElement.addEventListener("contextmenu",s),this.dispose=function(){v.domElement.removeEventListener("mousedown",i),v.domElement.removeEventListener("touchstart",o),v.domElement.removeEventListener("wheel",a),v.domElement.removeEventListener("contextmenu",s),document.removeEventListener("mousemove",n),document.removeEventListener("touchmove",n),document.removeEventListener("mouseup",h),document.removeEventListener("touchend",h)}}else this.dispose=function(){}}return p.install=function(t){j=t.THREE,w=new j.Vector3,a=new j.Vector3,s=new j.Vector3},p.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},p.prototype.rotateTo=function(t,e,i){var o=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=o,this._sphericalEnd.phi=a,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},p.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},p.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=j.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},p.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},p.prototype.truck=function(t,e,i){this.object.updateMatrix(),a.setFromMatrixColumn(this.object.matrix,0),s.setFromMatrixColumn(this.object.matrix,1),a.multiplyScalar(t),s.multiplyScalar(-e);var o=w.copy(a).add(s);this._targetEnd.add(o),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},p.prototype.forward=function(t,e){w.setFromMatrixColumn(this.object.matrix,0),w.crossVectors(this.object.up,w),w.multiplyScalar(t),this._targetEnd.add(w),e||this._target.copy(this._targetEnd),this._needsUpdate=!0},p.prototype.moveTo=function(t,e,i,o){this._targetEnd.set(t,e,i),o||this._target.copy(this._targetEnd),this._needsUpdate=!0},p.prototype.fitTo=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var o=i.paddingLeft||0,a=i.paddingRight||0,s=i.paddingBottom||0,r=i.paddingTop||0,n=t.isBox3?t.clone():(new j.Box3).setFromObject(t),h=n.getSize(w),c=h.x+o+a,p=h.y+r+s,d=h.z,l=this.getDistanceToFit(c,p,d);this.dollyTo(l,e);var m=n.getCenter(w),u=m.x-(.5*o-.5*a),g=m.y+(.5*r-.5*s),_=m.z;this.moveTo(u,g,_,e),this._sanitizeSphericals(),this.rotateTo(0,90*j.Math.DEG2RAD,e)}},p.prototype.setLookAt=function(t,e,i){this._targetEnd.copy(e),this._sphericalEnd.setFromVector3(w.subVectors(t,e)),this._sanitizeSphericals(),i||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},p.prototype.lerpLookAt=function(t,e,i,o,a,s){var r=(new j.Spherical).setFromVector3(w.subVectors(t,e)),n=(new j.Spherical).setFromVector3(w.subVectors(i,o)),h=n.theta-r.theta,c=n.phi-r.phi,p=n.radius-r.radius,d=(new j.Vector3).subVectors(o,e);this._sphericalEnd.set(r.radius+p*a,r.phi+c*a,r.theta+h*a),this._targetEnd.copy(e).add(d.multiplyScalar(a)),this._sanitizeSphericals(),s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},p.prototype.setPosition=function(t,e){this.setLookAt(t,this._targetEnd,e)},p.prototype.setTarget=function(t,e){this.setLookAt(this.getPosition(),t,e)},p.prototype.getDistanceToFit=function(t,e,i){var o=this.object,a=t/e,s=o.fov*j.Math.DEG2RAD,r=o.aspect;return.5*(a<r?e:t/r)/Math.tan(.5*s)+.5*i},p.prototype.getTarget=function(t){return("object"===(void 0===t?"undefined":e(t))&&t.isVector3?t:new j.Vector3).copy(this._targetEnd)},p.prototype.getPosition=function(t){return("object"===(void 0===t?"undefined":e(t))&&t.isVector3?t:new j.Vector3).setFromSpherical(this._sphericalEnd).add(this._targetEnd)},p.prototype.reset=function(t){this.setLookAt(this._position0,this._target0,t)},p.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},p.prototype.update=function(t){var e=1-Math.exp(-this.dampingFactor*t/.016),i=this._sphericalEnd.theta-this._spherical.theta,o=this._sphericalEnd.phi-this._spherical.phi,a=this._sphericalEnd.radius-this._spherical.radius,s=(new j.Vector3).subVectors(this._targetEnd,this._target);Math.abs(i)>n||Math.abs(o)>n||Math.abs(a)>n||Math.abs(s.x)>n||Math.abs(s.y)>n||Math.abs(s.z)>n?(this._spherical.set(this._spherical.radius+a*e,this._spherical.phi+o*e,this._spherical.theta+i*e),this._target.add(s.multiplyScalar(e)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var r=this._needsUpdate;return this._needsUpdate=!1,r},p.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:t(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:t(this.maxPolarAngle),minAzimuthAngle:t(this.minAzimuthAngle),maxAzimuthAngle:t(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},p.prototype.fromJSON=function(t,e){var i=JSON.parse(t),o=(new j.Vector3).fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=r(i.maxDistance),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=r(i.maxPolarAngle),this.minAzimuthAngle=r(i.minAzimuthAngle),this.maxAzimuthAngle=r(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._targetEnd.fromArray(i.target),this._sphericalEnd.setFromVector3(o.sub(this._target0)),e||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},p.prototype._sanitizeSphericals=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta+=2*Math.PI*Math.round((this._sphericalEnd.theta-this._spherical.theta)/(2*Math.PI))},p}()});
