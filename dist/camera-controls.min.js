!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";var D=void 0,w=void 0,o=void 0,s=void 0,r=.001,p=-1,S=0,F=1,z=2,L=3,k=4,P=5;function t(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function n(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}return function(){function d(t,e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),this.object=t,this.enabled=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.dollySpeed=1,this.truckSpeed=2,this.verticalDragToForward=!1,this.domElement=e,this.target=new D.Vector3,this._targetEnd=new D.Vector3,this._spherical=new D.Spherical,this._spherical.setFromVector3(this.object.position),this._sphericalEnd=(new D.Spherical).copy(this._spherical),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._zoom0=this.object.zoom,this._needsUpdate=!0,this.update(),this.domElement){var i=function(t){if(y.enabled){t.preventDefault();var e=x;switch(t.button){case D.MOUSE.LEFT:x=S;break;case D.MOUSE.MIDDLE:x=F;break;case D.MOUSE.RIGHT:x=z}e===p&&n(t)}},a=function(t){if(y.enabled){t.preventDefault();var e=x;switch(t.touches.length){case 1:x=L;break;case 2:x=k;break;case 3:x=P}e===p&&n(t)}},o=function(t){y.enabled&&(t.preventDefault(),t.deltaY<0?b():0<t.deltaY&&f())},s=function(t){y.enabled&&t.preventDefault()},n=function(t){if(y.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,a=e.clientY;if(j=y.domElement.getBoundingClientRect(),A.set(i,a),x===k){var o=i-t.touches[1].pageX,s=a-t.touches[1].pageY,n=Math.sqrt(o*o+s*s);M.set(0,n)}c=y.dampingFactor,y.dampingFactor=y.draggingDampingFactor,document.addEventListener("mousemove",r,{passive:!1}),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("mouseup",h),document.addEventListener("touchend",h)}},r=function(t){if(y.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,a=e.clientY,o=A.x-i,s=A.y-a;switch(A.set(i,a),x){case S:case L:var n=2*Math.PI*o/j.width,r=2*Math.PI*s/j.height;y.rotate(n,r,!0);break;case F:break;case k:var h=i-t.touches[1].pageX,c=a-t.touches[1].pageY,d=Math.sqrt(h*h+c*c),p=M.y-d;0<p?f():p<0&&b(),M.set(0,d);break;case z:case P:if(y.object.isPerspectiveCamera){var m=w.copy(y.object.position).sub(y.target),l=y.object.fov*D.Math.DEG2RAD,u=m.length()*Math.tan(l/2),g=y.truckSpeed*o*u/j.height,_=y.truckSpeed*s*u/j.height;y.verticalDragToForward?(y.truck(g,0,!0),y.forward(-_,!0)):y.truck(g,_,!0);break}if(y.object.isOrthographicCamera){var v=o*(y.object.right-y.object.left)/y.object.zoom/j.width,E=s*(y.object.top-y.object.bottom)/y.object.zoom/j.height;y.truck(v,E,!0);break}}}},h=function t(){y.enabled&&(y.dampingFactor=c,x=p,document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t))},b=function(){var t=Math.pow(.95,y.dollySpeed);y.object.isPerspectiveCamera?y.dolly(y._sphericalEnd.radius*t-y._sphericalEnd.radius):y.object.isOrthographicCamera&&(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom*t)),y.object.updateProjectionMatrix(),y._needsUpdate=!0)},f=function(){var t=Math.pow(.95,y.dollySpeed);y.object.isPerspectiveCamera?y.dolly(y._sphericalEnd.radius/t-y._sphericalEnd.radius):y.object.isOrthographicCamera&&(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom/t)),y.object.updateProjectionMatrix(),y._needsUpdate=!0)},y=this,A=new D.Vector2,M=new D.Vector2,x=p,j=void 0,c=void 0;this.domElement.addEventListener("mousedown",i),this.domElement.addEventListener("touchstart",a),this.domElement.addEventListener("wheel",o),this.domElement.addEventListener("contextmenu",s),this.dispose=function(){y.domElement.removeEventListener("mousedown",i),y.domElement.removeEventListener("touchstart",a),y.domElement.removeEventListener("wheel",o),y.domElement.removeEventListener("contextmenu",s),document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",h),document.removeEventListener("touchend",h)}}else this.dispose=function(){}}return d.install=function(t){D=t.THREE,w=new D.Vector3,o=new D.Vector3,s=new D.Vector3},d.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},d.prototype.rotateTo=function(t,e,i){var a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=a,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},d.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},d.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=D.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},d.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},d.prototype.truck=function(t,e,i){this.object.updateMatrix(),o.setFromMatrixColumn(this.object.matrix,0),s.setFromMatrixColumn(this.object.matrix,1),o.multiplyScalar(t),s.multiplyScalar(-e);var a=w.copy(o).add(s);this._targetEnd.add(a),i||this.target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.forward=function(t,e){w.setFromMatrixColumn(this.object.matrix,0),w.crossVectors(this.object.up,w),w.multiplyScalar(t),this._targetEnd.add(w),e||this.target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.moveTo=function(t,e,i,a){this._targetEnd.set(t,e,i),a||this.target.copy(this._targetEnd),this._needsUpdate=!0},d.prototype.fitTo=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var a=i.paddingLeft||0,o=i.paddingRight||0,s=i.paddingBottom||0,n=i.paddingTop||0,r=t.isBox3?t.clone():(new D.Box3).setFromObject(t),h=r.getSize(w),c=h.x+a+o,d=h.y+n+s,p=h.z,m=this.getDistanceToFit(c,d,p);this.dollyTo(m,e);var l=r.getCenter(w),u=l.x-(.5*a-.5*o),g=l.y+(.5*n-.5*s),_=l.z;this.moveTo(u,g,_,e),this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta=this._spherical.theta%(2*Math.PI),this.rotateTo(0,90*D.Math.DEG2RAD,e)}},d.prototype.getDistanceToFit=function(t,e,i){var a=this.object,o=t/e,s=a.fov*D.Math.DEG2RAD,n=a.aspect;return.5*(o<n?e:t/n)/Math.tan(.5*s)+.5*i},d.prototype.reset=function(t){this._targetEnd.copy(this._target0),this._sphericalEnd.setFromVector3(w.subVectors(this._position0,this._target0)),this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta=this._spherical.theta%(2*Math.PI),t||(this.target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d.prototype.saveState=function(){this._target0.copy(this.target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},d.prototype.update=function(t){var e=1-Math.exp(-this.dampingFactor*t/.016),i=this._sphericalEnd.theta-this._spherical.theta,a=this._sphericalEnd.phi-this._spherical.phi,o=this._sphericalEnd.radius-this._spherical.radius,s=(new D.Vector3).subVectors(this._targetEnd,this.target);Math.abs(i)>r||Math.abs(a)>r||Math.abs(o)>r||Math.abs(s.x)>r||Math.abs(s.y)>r||Math.abs(s.z)>r?(this._spherical.set(this._spherical.radius+o*e,this._spherical.phi+a*e,this._spherical.theta+i*e),this.target.add(s.multiplyScalar(e)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this.target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this.target),this.object.lookAt(this.target);var n=this._needsUpdate;return this._needsUpdate=!1,n},d.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:t(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:t(this.maxPolarAngle),minAzimuthAngle:t(this.minAzimuthAngle),maxAzimuthAngle:t(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},d.prototype.fromJSON=function(t,e){var i=JSON.parse(t),a=(new D.Vector3).fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=n(i.maxDistance),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=n(i.maxPolarAngle),this.minAzimuthAngle=n(i.minAzimuthAngle),this.maxAzimuthAngle=n(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._targetEnd.fromArray(i.target),this._sphericalEnd.setFromVector3(a.sub(this._target0)),e||(this.target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},d}()});
